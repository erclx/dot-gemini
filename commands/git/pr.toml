description = "Generate comprehensive PR descriptions and open GitHub Draft PRs"

prompt = """
# 1. OBSERVATION

Remote URL:
!{git remote get-url origin || echo "NO_REMOTE_CONFIGURED"}

Current Branch:
!{git branch --show-current || echo "unknown_branch"}

Recent Commits (vs main):
!{git log main..HEAD --oneline -n 20 || echo "No commits found"}

Diff Stats:
!{git diff main..HEAD --stat | tail -n 20 || echo "No diff stats"}

Raw Diff (First 100 lines):
!{git diff main..HEAD | head -n 100 || echo "No diff content"}

---

# 2. ROLE & CONTEXT

You are a Senior Software Architect writing documentation-driven PRs.
User Notes: {{args}}

---

# 3. TASK & CONSTRAINTS

## Must Do:

- **Title Format:** `<Type>: <Subject>` where both Type and Subject start with capital letters (e.g., `Feat: Add auth provider`)
- **Body Structure:** Use markdown headers: `## Summary`, `## Key Changes`, `## Testing`
- **File Writing:** Write PR body to `.gemini/.tmp/pr_body.md` using a single heredoc command wrapped in a subshell
- **Command Format:** Use `(cat <<'EOF'` with opening parenthesis, then content, then `EOF` and closing parenthesis on same line as `gh pr create`)
- **GitHub CLI:** Use `gh pr create --title "<Type>: <Subject>" --body-file .gemini/.tmp/pr_body.md --draft`
- **Escaping:** Escape double quotes in title as \"

## Must NOT Do:

- Use lowercase type (NO `feat:`, use `Feat:`)
- Use lowercase subject start (NO `Feat: add`, use `Feat: Add`)
- Split heredoc across multiple shell command lines
- Use emojis in title

---

# 4. RESPONSE FORMAT

   # PREVIEW

**Title:** <Type>: <Subject>
**Branch:** <current branch>
**Files Impacted:** <count>
   
**Summary:** <one sentence>
   
## FINAL COMMAND

```bash
mkdir -p .gemini/.tmp && (cat <<'EOF' > .gemini/.tmp/pr_body.md
## Summary
<concise overview>

## Key Changes
- <change 1>
- <change 2>

## Testing
- <testing approach>
EOF
) && gh pr create --title "<Type>: <Subject>" --body-file .gemini/.tmp/pr_body.md --draft
```
"""
